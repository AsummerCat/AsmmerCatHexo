---
title: ElasticSearch笔记倒排索引与正排索引(九)
date: 2020-08-11 14:07:47
tags: [ElasticSearch笔记]
---

# ElasticSearch笔记倒排索引与正排索引(九)

## 本质
```
搜索的时候,要依靠倒排索引;
排序的时候,需要依靠正排索引,看到每个document的每个field,然后进行排序,
所谓的正排索引,其实就是doc values


在建立索引的时候,一方面会家里倒排索引,以供搜索;
一方面会建立正排索引,也就是doc values,以供排序,集合,过滤等操作使用

doc values是被保存在磁盘上的,此时如果内存足够,os会自动将其缓存在内存中,性能还是会很高;如果内存不足够,os会将其写入磁盘上

创建mapping的时候->加入 "fielddata": true 可开启正排索引

```
<!--more-->
## 倒排索引组成结构以及其索引不可变的原因

#### 倒排索引的组成结构
```
1.包含这个关键词的document list

2.包含这个关键词的document的数量

3.这个关键词在每个document中出现的次数

4.这个关键词在这个document中的次序

5.每个document的长度

6.包含这个关键词的所有document的平均长度

```

#### 索引不可变的原因
##### 好处
```
1.不需要锁,提升并发能力,避免锁的问题

2.数据不变,一直保存在os cache中,只要cache内存足够

3.filyer cache一直驻留在内存,因为数据不变

4.可以压缩,节约cpu和io开销


```
##### 坏处
```
倒排索引不可变的坏处: 每次都要重新构建整个索引
```