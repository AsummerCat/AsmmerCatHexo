---
title: 问题点
date: 2019-01-02 11:18:08
tags: 问题点
---

# 问题点

# # aop编入后 如果aop报错 事物回滚? (完成)

 aop编入后 方法 入口简单来说就变成 (  原方法+切面)=完整方法  



# redis 缓存击穿后如何处理?

  1.定义key的规范 在外层就过滤一遍 提出不符合规范的key 避免直接访问到 

2. ### 使用双重检测锁 

   类似于这种

   ```java
   public List<UsersDO> getAllUserWithNoPage(){
    
    
           try{
    
               //序列化器，将key的值设置为字符串
               RedisSerializer redisSerializer=new StringRedisSerializer();
               redisTemplate.setKeySerializer(redisSerializer);
    
               //查缓存
               List<UsersDO> list=(List<UsersDO>)redisTemplate.opsForValue().get("allUsers");
    
               if(null==list){
                   //双重检测 锁
                   synchronized (this) {
    
                       List<UsersDO> list1 = (List<UsersDO>) redisTemplate.opsForValue().get("allUsers");
                       if (null == list1) {
    
                           UsersQuery query=new UsersQuery();
                           list=usersDOMapper.selectByExample(query);
                           redisTemplate.opsForValue().set("allUsers", list);
    
                           System.out.println("从数据库中取数据");
                       }
                       else{
                           System.out.println("从缓存中取数据");
                       }
                   }
               }
               else{
                   System.out.println("从缓存中取数据");
               }
               return list;
           }
           catch (Exception e) {
               logger.error("UserService.getAllUserWithNoPage error",e);
           }
           return null;
       }
   ```


