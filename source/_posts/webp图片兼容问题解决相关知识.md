---
title: webp图片兼容问题解决相关知识
date: 2019-05-30 23:03:19
tags: [前端]
---

webp是谷歌开发的一个图片格式，跟普通的jpg比起来，如果同大小的图片情况下，webp会比较清晰。

火狐也开始支持webp格式，所以以后webp就是前端的趋势。但是ie浏览器不支持，这里需要做兼容考虑。

WebP既支持有损压缩也支持无损压缩。相较编码JPEG文件，编码同样质量的WebP文件需要占用更多的计算资源。

在线转换webp：https://www.upyun.com/webp


# 浏览器支持

1.前端JS方案–利用img标签加载一张base64的webP图片，在img标签的onload事件中判断图片是否具有宽高的属性，若有表示支持webP，若没有表示不支持webP。

2.后台判断方案–判断浏览器请求头Accept是否支持webP，返回是否支持的标致给前台。

3.IOS独立客户端方案–使用官方提供的开发工具，客户端先拉去webP格式的图片，下载完成后在客户端实时转码，将webP图片转换为jpg或png图片，展示给用户的是普通图片。此方法的优点在于缩小了图片体积，节省了带宽而用户实际等待时间相差不大。

4.ANDROID客户端方案–客户端判断用户系统版本，android系统版本大于4.0时，原生都支持webP格式的静态图片。动态图片需使用flash来做兼容

5.兼容方案–对于不支持webP的浏览器，也可采用flash作为载体来加载webP图片，用户下载时，可捕获事件，并返回普通的jpg或png格式文件。

# 其他方法兼容

<!--more-->
##  picture标签

`<picture>`是HTML5中的一个新标签，类似<video>它也可以指定多个格式的资源，由浏览器选择自己支持的格式进行加载。

```
<picture class="picture">
  <source type="image/webp" srcset="image.webp">
  <img class="image" src="image.jpg">
</picture>
```
如果浏览器支持WebP格式，就会加载image.webp，否则会加载image.jpg。

即使浏览器不支持<picture>标签，图片仍然会正常显示，只是CSS可能无法正确选取到picture元素。比如在IE8中，下面的CSS就不会起作用：

```
.picture img {
  width: 100px;
  height: 100px;
}
```
但是可以这样来给图片写样式：
```
.image {
  width: 100px;
  height: 100px;
}
```
即使浏览器使用的是WebP格式的图片，最终还是会应用img元素的样式。

## 使用JS解码WebP图片

既然WebP的解码器是开源的，那么能否用JS来实现呢？当然可以，有人就用JS写出了WebP的解码器。引入这个JS库，就是将所有的WebP图片用JS解码后转换为base64，然后替换掉原来的URL，这样就可以让原本不支持WebP的浏览器正常显示WebP了。这个库的使用方法非常简单，看网页的说明即可。

这种方法的缺点是，因为JS要解码WebP图片，需要在此异步请求src中的URL（不过因为图片本身之前被下载了一次，直接使用了缓存）；而且JS解码比较慢，对性能有影响，可能需要一段时间才能显示出图片来。

以上就是在浏览器中使用WebP图片的几种方法，可以根据自己的实际情况选用。在我们的实践中，使用了WebP格式后，图片的体积普遍缩小了1/3以上，既加快了加载的速度，还节省了用户的流量，我们十分推荐从现在就开始使用这种格式。