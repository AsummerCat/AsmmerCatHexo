---
title: K8S笔记概念(一)
date: 2020-07-30 09:25:44
tags: [K8S笔记]
---

# K8S笔记概念(一)
## Kubernetes特点
```
* 轻量级:资源消耗小
* 开源
* 动态伸缩
* 负载均衡: IPVS

```
<!--more-->

## 知识图谱
![k8s架构图](/img/2020-07-25/7.png)
![k8s架构图](/img/2020-07-25/15.png)

```
1.pod
 pod是k8s中最小的一个单位
  一个pod可以有多个docker容器
  也就是说用来管理docker容器的

2.Service
  服务发现

3.调度器
  能够根据要求吧Pod定义到想要的节点运行
  
4. 安全
   集群的认证 鉴权 访问控制
   
5. HELM 模板 
   类似Linux yum  可以部署一些常用插件
   例如:一条命令安装redis集群到k8s中 
 
6.etcd  v3 分布式键值存储数据    
   
```

#### Kubeadm安装集群
高可用集群副本数据最好是 ` >=3`的奇数个
```
 注意:
   需要修改源码   因为通过Kubeadm安装的集群证书默认就1年

```

## 组件说明
![主要组件](/img/2020-07-25/14.png)
#### 主要组件
```
apiServer: 所有服务统一访问吐口
CrontrollerManager: 维持副本期望数目
Scheduler: 负责介绍任务,选择合适的节点进行分配任务
ETCD: 键值对数据库,储存K8S集群所有很重要信息(持久化)
Kubelet: 直接跟容器引擎交互实现容器的生命周期管理
Kube-proxy: 负责写入规则至 IPTABLES,IPVS 实现服务映射访问的

其他插件:
CoreDNS: 可以为集群中国的SVC创建一个域名IP的对应关系解析 (不同通过pod的ip ,可以直接这个解析)
Dashboard: 给K8S集群提供一个B/S结构的访问体系
Ingress Controlier: (官方提供四层代理) 这个可以提供七层代理
Fedetation: 提供一个可以跨集群中心多k8s统一管理功能
Prometheus: 提供一个K8S集群的监控能力

ELK: 提供k8s集群日志统一分析介入平台

```

# pod

##### 基本概念:
```
一个Pod中
多个容器共享一个网络栈 和共享卷
```

##### Pod控制器类型:
```

* ReplicationController 
    用来确保容器应用的副本数始终保持在用户定义的副本数
  即: 如果有容器异常退出,会自动创建新的Pod来替代
  新版本中 建议使用 ReplicaSet来取代ReplicationController
* ReplicaSet
   虽然可以单独使用,但一般还是建议使用Deployment来自动管理ReplicaSet,这样就无需担心和其他机子的不兼容
   这样可以实现滚动更新(类似灰度发布    )
* Deployment
  不支持自动创建pod 所以要搭配ReplicaSet使用

> HPA(HorizontalPodAutoScale) 平滑扩展
 类似于 监控容器资源达到阀值(例如CPU->80%) 新建Pod 直到达到设置的最大值
(仅限于以上三种)
   >以上三种类似
   
* StatefullSet
  解决了有状态服务 
  稳定的持久化存储
  稳定的网络标志
  有序部署 (一个启动成功后,才能启动下一个)
  有序收缩 (有序删除 ,即 N-1到0)
  
  例如:pod死亡 被替换后 原有持久化存储不会消失
  原有pod标识都不会变化
* DaemonSet
 确保全部的Node运行一个Pod的副本,
 当有Node加入集群时,新增一个Pod,
 当有Node从集群中移除,这些Pod也会被回收,删除他创建的所有Pod
 > 类似一个守护进程 用来收集日志啥的

* Job , Cron Job
  Job:
  负责批处理任务,即仅执行一次的任务,它保证批处理任务的一个或多个Pod成功结束.
  ->异常退出,会重新执行该job
  Cron Job:
  即 管理基于时间的job (类似定时任务)
  * 在给定时间点只运行一次
  * 周期性地在给定时间点运行
```

## 网络通讯方式

k8s假定了所有的pod都在一个可以直接连通的扁平的网络空间中  
简单来说->可以认为所有的pod都可以通过ip直接访问 

![网络通讯方式](/img/2020-07-25/8.png)   

常用:  
  `Flannel`来解决我们的网络规划  
  ```
  可以让我们集群中的不同节点注解创建的docker容器都均有全集群唯一的虚拟IP地址,
  还能在这些IP地址之间建立一个覆盖网络,通过这个覆盖网络,
  将数据包原封不动的传递到目标容器内
  ```
  可以跨主机访问   
  ![Flannel](/img/2020-07-25/9.png)  

  ETCD之Flannel提供说明:
  ```
  ETCD监控路由表 防止IP冲突 
  
 * 存储管理Flannel可分配的IP地址段资源
 
 * 监控ETCD中每个Pod的实际地址,并在内存中建立维护Pod节点路由表
  
  ```

  ![Flannel](/img/2020-07-25/10.png)  

 ### 总结
  ![网络通信总结](/img/2020-07-25/11.png)  
