---
title: Mybatis缓存之一级二级缓存
date: 2020-09-26 19:22:37
tags: [mybatis源码解析]
---

# 一级缓存
基于单个`SqlSession`下  
默认开启
```
也就是
在一个方法中 
调用两次相同的查询方法,第二次查询会直接去缓存中拿数据

减少db压力

update 和delete语句 会删除缓存
```
<!--more-->

# 二级缓存
类似于全局缓存 默认关闭,可手动开启  
范围: 当mapping下 或者全局
```
在全局下 无论查询几个mapping都会把查询结果缓存下来

比如A.mapping查询出数据  
B.mapping再去查询可能就会走二级缓存了

注意: update delete 同样是删除全部缓存


缺点:
比如 A.mapping更新了数据  

    B.mapping的数据可能还是旧缓存的数据(存在脏数据)


```

# 缓存源码解读

## 生成方式

![](/img/2020-09-26/3.png)

![](/img/2020-09-26/2.png)

## 一级缓存

![](/img/2020-09-26/1.png)

## 二级缓存

![](/img/2020-09-26/4.png)

![](/img/2020-09-26/5.png)

![](/img/2020-09-26/6.png)

![](/img/2020-09-26/7.png)

![](/img/2020-09-26/8.png)