---
title: rabbitMQ笔记概念(一)
date: 2020-09-12 14:35:21
tags: [rabbitMQ笔记]
---

# rabbitMQ笔记概念(一)
## 什么是队列

队列就像存放了商品的仓库或商店,是生产商品的工厂和购买商品的用户之间的中转站

## 队列里存储了什么
在  rabbitMQ中,信息流从你的应用出发,来到rabbitMQ的队列,所有的消息可以只存储在一个队列中.队列可以存储很多信息,因为它基本上是一个无限制的缓冲区,前提是你的机器有足够的存储空间

## 队列和应用程序的关系
  多个生产者可以将消息发送到同一队列中,多个消费者也可以只从一个队列接收数据

  <!--more-->
##   执行流程
```
1.客户端发送消息,到Exchange交换机

2. 交换机绑定了queue

3.客户端监听队列,获取数据消费
```

# 原理
## Message (消息)
 消息.  
 消息是不具名的,它是由消息头消息体组成的.消息体是不透明的,而消息头则由一系列可选属性构成  ,这些属性包括:`routing-key`(路由键),`priority`(相对于其他消息的优先权),`delivery-mode`(指出消息可能持久化存储)等

## publisher(生产者)
消息的生产者  
也是一个向交换机发布消息的客户端应用程序

## Consumer(消费者)
消息的消费者  
表示从消息队列中获得消息的客户端应用程序

## Exchange(交换机)
 交换机  
 用来接收生产者发送的消息并将这些消息路由给服务器中的队列
 ```
1.direct (发布与订阅 完全匹配)

2.fanout (广播)

3.topic (主题,规则匹配)
 ```

## Binding(绑定)
 绑定  
 用户消息队列和交换机之间的关联.  
 一个绑定就是基于路由键将交换机和消息队列连接起来的路由规则,所以可以将交换机理解成一个由绑定构成的路由表

## Queue(消息队列)
 消息队列  
 用于保存消息直到发送给消费者.   
 它是消息的容器,也是消息的终点. 一个消息可投入一个或多个队列里面,等待消费者链接到这个队列将其取走.

## Routing-key(路由键)
 路由键  
 rabbitMQ决定消息该投递到哪个队列的规则.  
 队列通过路由键绑定到交换机.  
 消息发送给MQ服务器时,消息将拥有一个路由键,即便是空的,RabbitMQ也会将其和绑定使用的路由键进行匹配.

  如果相匹配,消息将会投递到改队列  
  如果不匹配,消息将会进入黑洞

## Connection(链接)
 链接  
 指rabbitMQ服务器和服务(消费者)建立的TCP链接

## Channel (信道)
  信道  
1. Channel是TCP里面的虚拟链接.例如:电缆相当于TCP,信道是一个独立光纤,一条TCP链接上创建多个信道是没有问题的
2. TCP一旦打开,就会建立AMQP信道
3. 无论是`发布消息`,`接收消息`,`订阅队列`,这些动作都是通过信道完成的

## Virtual Host (虚拟主机)
 虚拟主机  
 表示一批交换机,消息队列和相关对象  
 虚拟主机是共享相同的身份认证和加密环境的独立服务器域.<font color="red">每个vhost本质就是一个mini版的rabbitMQ服务器,拥有自己的队列,交换机,绑定和权限机制.  
 vhost是AMQP的概念的基础,必须在链接时指定,  
 rabbiMQ默认的vhost是/
 </font>

## Borker (消息队列服务器实体)
 表示消息队列服务器实体  
 <font color="red">Borker可以拥有多个Vhost  
  怎么说呢 Borker这个就是rabbitmq服务器,
  而vhost就等于里面的一个镜像(一套mini的rabbit)  
  Borker类似dockr的概念
 </font>  

![rabbitMQ概念](/img/2020-08-19/1.png)

## rbbitMQ为什么需要通道?而不是TCP直接通信?
1. TCP的创建和销毁开销特别大.创建需要三次握手,销毁需要四次挥手  
2. 如果不用信道,那么应用程序就会以TCP链接rabbitMQ,高峰时每秒成千上万条链接会造成资源巨大的浪费,而且操作系统每秒处理TCP链接数也是有限制的,必定造成性能瓶颈.
3. 信道的原理是一条线程一条通道,多条线程多条通道通用一条TCP链接.一条TCP链接可以扩容无限的信道,即使每秒成千上万的请求也不会成为性能的瓶颈

# 集群模式
```
rabbitmq 的集群分两种模式 一种是默认模式 一种是镜像模式
```