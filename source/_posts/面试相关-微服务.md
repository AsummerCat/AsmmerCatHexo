---
title: 面试相关-微服务
date: 2020-02-04 00:30:48
tags: [面试相关]
---

# 微服务

### dubbo 的负载均衡有几种算法?

```
随机，轮询，最少活跃请求数，一致性 hash
```

### 理论CAP理论和BASE理论

```
CAP理论:
一致性（Consistency）
可用性（Availability）
分区容错性（Partition tolerance）
最多达到两种 :
     分布式系统要么满足CA,要么CP，要么AP。无法同时满足CAP
     如eureka就是 AP   zk就是CP

```

```
BASE理论:
     基本可用（Basically Available）
     软状态（Soft state）
     最终一致性（Eventually consistent）
```

<!--more-->

### 分布式事务

```
分布式事务大概分为：
2pc（两段式提交）
3pc（三段式提交）
TCC（Try、Confirm、Cancel）
最大努力通知
XA
本地消息表（ebay研发出的）
半消息/最终一致性（RocketMQ）
```



## SpringCloud的基础功能

```
SpringCloud的基础功能：

服务治理：Spring Cloud Eureka

客户端负载均衡：Spring Cloud Ribbon

服务容错保护：Spring Cloud Hystrix  

声明式服务调用：Spring  Cloud Feign

API网关服务：Spring Cloud Zuul

分布式配置中心：Spring Cloud Config

SpringCloud的高级功能(本文不讲)：

消息总线：Spring  Cloud Bus

消息驱动的微服务：Spring Cloud Stream

分布式服务跟踪：Spring  Cloud Sleuth
```

# eureka源码

```
底层维护一个 hashMap
维护了注册到eureka的服务
```

###  注册流程

```
## 注册流程
1.注册接口  ApplicationResource.addInstance
2. 注册方法 serviceRegistry.register(this.registration)
3.将实例信息写入注册表的ConcurrentHashMap中
4.清理缓存 invalidateCache
```

### 获取注册接口

```
## 获取注册接口
1.从缓存获取实例 :responseCache.get(cacheKey)
2.从只读缓存获取 readOnlyCacheMap.get(key)         
      |  定时器默认30秒执行CacheUpdateTask任务更新读写缓存的内容进入只读缓存 
3.只读缓存不存在 ->去 读写缓存获取 readWriteCacheMap.get(key)    
      |  默认180秒过期
4.还是没有就直接从内存注册表里面获取
```

 

# 真题

### 如何保证接口的幂等性?

```
处理方案: 接口幂等性处理
    强检查: 查询id 订单号+业务场景(做主键) 不存在继续操作 存在 return   (重要场景)
    弱检查: redis缓存id 判断id 是否存在    (比如判断发送通知短信)
```

