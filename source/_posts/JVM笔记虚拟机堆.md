---
title: JVM笔记虚拟机堆
date: 2020-07-22 14:50:36
tags: [JVM笔记]
---

# JVM笔记虚拟机堆
## `重要`
=========

## GC概念
● Major GC 是清理永久代。   
● Minor GC 是清理新生代  
● Full GC 是清理整个堆空间—包括年轻代和永久代

<!--more-->

## 堆是分配对象存储的唯一选择吗
![堆是分配对象存储的唯一选择吗](/img/2020-07-02/20.png)  

## 堆的内存细分
![堆的内存细分](/img/2020-07-02/21.png)  

### 堆空间大小的设置
```
-Xms   堆初始化大小
-Xmx   堆最大容量

超出-Xmx大小 则OOM
```
默认情况下 :  
初始化堆大小 = 物理电脑内存 /64  
最大堆大小 =物理电脑内存 /4

## 堆区域细分
新生代,老年代 GC的主要区域  
![堆区域细分](/img/2020-07-02/22.png) 

### JVM参数修改新生代与老年代的占比
```
默认新生代占堆的1/3 老年代2/3 
修改新生代老年代的占比 :-XX:NewRatio=2 
```
```
默认:新生代中的伊甸园区和s0,s1的比例->8:1:1
修改新生代:  -XX:SurvivorRatio=8

ps: 如果占比不对的话 是因为有自适应内存分配的关系
手动关闭自适应内存分配:
-xx:-UseAdaptiveSizePolicy


还有一个参数: -Xmn 设置新生代的最大内存
```
![JVM参数修改新生代与老年代的占比](/img/2020-07-02/23.png)   
![JVM参数修新生代中的伊甸园区和s0,s1的比例](/img/2020-07-02/24.png)

### 新对象默认15次minor GC还存在的话
<font style="color:red">15次还存在 就移动到老年代</font>可以设置JVM参数调整次数
```
手动修改对象在新生代经历几次minor GC后移动到老年代
JVM参数: -XX:MaxTenuringThreshold=N 
来进行设置
```

## 堆空间常见JVM参数:
![堆空间常见JVM参数](/img/2020-07-02/27.png)   