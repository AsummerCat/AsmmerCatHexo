---
title: 面试相关-分布式搜索
date: 2020-02-14 14:48:34
tags: [面试相关]
---

# es

<!--more-->

## 最小存储单位

```
存取数据单位 :索引 

索引的概念:创建一个order_idex索引, 所有的订单数据都写入到这个索引中去  相当于(mysql一张表)
索引结构: index->type->mapping->document->field

index: mysql的一张表
type: 拥有多个数据结构  大部分字段相等 类似 多个表结构(虚拟)   (一般来就一个type)
mapping:  每个type有个mapping   mapping代表type的表结构定义 (每个字段名称 配置等)
document: type具体存放的内容
field:  每个field代表了这个document中的一个字段的值
```



## lucene底层

```
倒排索引

举例: 
比如有三个地址:
url1 -> “我爱北京”
url2 -> “我爱到家”
url3 -> “到家美好”
这是一个正排索引Map<url, page_content>。

分词为 
url1 -> {我，爱，北京}
url2 -> {我，爱，到家}
url3 -> {到家，美好}
这是一个分词后的正排索引Map<url, list<item>>。

分词后倒排索引：
我 -> {url1, url2}
爱 -> {url1, url2}
北京 -> {url1}
到家 -> {url2, url3}
美好 -> {url3}
由检索词item快速找到包含这个查询词的网页Map<item, list<url>>就是倒排索引。

查询时间复杂度为O(1) 大大提升了效率


```



# 真题

## es和solr的区别

```
建立索引     solr阻塞       es不会阻塞
动态添加数据 solr会变慢      es没变化
分布式管理   solr利用zk     es有自己的分布式管理功能
格式        solr多格式      es仅json格式
搜索方案     solr传统搜索    es 新兴的实时搜索
对已有数据搜索 solr效率快        es慢
```



## es的分布式架构原理

```


核心思想: 多台机子启动多个es进程实例 ,组成一个集群.搞一个索引,这个索引可以拆分成多个shard(碎片化),每个shard存储部分数据.
每个shard有多个备份 , 也就是说只有一个可以写入primary shard ,多个replica shard同步读取(类似读写分离)

master机子宕机后 会(选举机制) 选取一个节点为master节点.
非master机子宕机后 , master会将宕机节点的primary shard身份转移到他的备份机子,恢复后 再转移回去,同步后续修改的数据
```

## es的写入原理是什么?查询原理是什么? 底层lucenne的倒排索引是什么?

```

```

## es数据量很大的情况下(数十亿级别)如何提高查询效率?

```

```



## es的生产集群部署架构是什么?每个索引的数据量大概有多少?每个索引大概有多少个分片?

```

```

