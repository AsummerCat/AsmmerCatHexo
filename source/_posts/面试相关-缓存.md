---
title: 面试相关-缓存
date: 2020-02-03 22:15:59
tags: [java,面试相关]
---

## 缓存

```
缓存分为 本地缓存 多级缓存 分布式缓存
```

### 淘汰策略

```
淘汰策略: FIFO(先进先出)   
         LRU(最近最少使用数据)   
         LFU(最低使用频率的数据)
```

### 缓存问题处理

<!--more-->

```java
缓存问题处理: 
       1.缓存不一致
            数据变更,缓存时效性   增加重试,补偿任务,最终一致  尝试在代码中操作的时候先更新DB再更新缓存
       
       2.缓存穿透
              恶意攻击         空对象做缓存, 使用布隆过滤器->不存在直接返回NULL
         
       3.缓存击穿
             热点key失效        互斥更新,随机退避,差异失效时间 比如加上一个锁 或者CAS操作
         
       4.缓存雪崩
            缓存宕机或者大批量的key失效           缓存宕机:   快速失败熔断,主从模式,集群模式
                                        大批量的key失效:   那就设置不同的过期时间避免同一时间段失效
         
```



## redis

### 好处

```
好处:   单线程异步IO  支持持久化 多数据结构 主从模式
```

### 数据结构

```
数据结构 :
      String: 任何数据      例如: 封锁id和访问次数
      hash:   存储对象      例如: 用户信息
      list:   字符串列表    例如: 最新消息的排行 ,利用list的push将任务存在list中 再用pop读取 模拟队列
      set:    无序集合      例如: 微博好友列表 去重  共同好友取交集
      zset:   有序集合      例如: 根据某个条件进行排序 例如商品列表排序
      
      还有其他的
      bitmap: 用来实现布隆过滤器
      HyperLogLog: 提供 不精确的去重计数功能
      
```

### 持久化方案

```
持久化:
   AOF: 操作日志    占空间   恢复备份速度慢   如果存在部分BUG则导致无法恢复
   RDB: 快照数据写入内存   节省磁盘空间  恢复速度快 最后一次持久化后数据丢失
```

### redis的分布式方案

```
使用redison框架 来实现redis的分布式操作 
基于lua操作
```



## zk

### zk的作用

```
统一配置管理、统一命名服务、分布式锁、集群管理
例如dubbo用zk做注册中心
```



### zk的分布式锁方案

```
分布式方案 curator
使用临时顺序节点来控制锁
```



# 真题

### 如果redis中的某个列表中的数据量非常大，如果实现循环显示每一个值？

```
利用分片获取 减少服务器压力

# 通过scan_iter分片取，减少内存压力
scan_iter(match=None, count=None)增量式迭代获取redis里匹配的的值
# match，匹配指定key
# count，每次分片最少获取个数
    r = redis.Redis(connection_pool=pool)
    for key in r.scan_iter(match='PREFIX_*', count=100000):
        print(key)
```

### 分布式锁的选择

```
redis:  redisson
zk:     curator 
```

### redis的过期策略都有哪些？内存淘汰机制都有哪些？手写一下LRU代码实现？

```
过期策略：①定期删除②惰性删除
内存淘汰机制：  
     LRU(最近最少使用数据)   
     LFU(最低使用频率的数据)
     随机删除
     
```

### 选择 memeched还是redis?

```
单纯 K-V 缓存的场景可以使用 MC，而需要缓存 list、set 等特殊数据格式，可以使用 Redis；
```

