---
title: 面试相关-消息队列
date: 2020-02-04 00:01:48
tags: [面试相关,消息队列]
---

# 消息队列

### 作用

```
作用: 异步、削峰、解耦
```



### **重复消费**问题

```
处理方案: 接口幂等性处理
    强检查: 查询id 订单号+业务场景(做主键) 不存在继续操作 存在 return   (重要场景)
    弱检查: redis缓存id 判断id 是否存在    (比如判断发送通知短信)
```

### 顺序消费

```
1.保证消息都投递到一个队列中 ,并且只有一个消费者

```



### 分布式事务

```
分布式事务大概分为：
2pc（两段式提交）
3pc（三段式提交）
TCC（Try、Confirm、Cancel）
最大努力通知
XA
本地消息表（ebay研发出的）
半消息/最终一致性（RocketMQ）
```



# 真题

### 如何保证rabbitMQ不会消息丢失?

```
1.消息持久化

2.ACK确认机制

3.设置集群镜像模式   HA方案

4.消息补偿机制  写入DB日志
```

### 你觉得它有什么缺点吗？或者说怎么考虑用不用消息队列？

```
1.系统可用性降低： 系统可用性在某种程度上降低，为什么这样说呢？在加入 MQ 之前，你不用考虑消息丢失或者说 MQ 挂掉等等的情况，但是，引入 MQ 之后你就需要去考虑了！
2.系统复杂性提高： 加入 MQ 之后，你需要保证消息没有被重复消费、处理消息丢失的情况、保证消息传递的顺序性等等问题！
3.一致性问题： 我上面讲了消息队列可以实现异步，消息队列带来的异步确实可以提高系统响应速度。但是，万一消息的真正消费者并没有正确消费消息怎么办？这样就会导致数据不一致的情况了!
```

