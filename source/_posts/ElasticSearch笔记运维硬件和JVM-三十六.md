---
title: ElasticSearch笔记运维硬件和JVM(三十六)
date: 2020-09-03 22:16:40
tags: [ElasticSearch笔记]
---

# 运维管理


## 内存设置
尽可能大于8G以上 因为es进程需要分配足够的`jvm heap`和`os cache`  
一般来说es用`jvm heap`还是用的比较少,主要吃的是你的机器内存

<!--more-->

## CPU设置
es集群对于CPU要求不高,  
2-8个核心数就够了  
如果要选择较少cpu core但是cpu性能高,还是较多的cpu core但是cpu性能较为一般, 那么肯定是选择性能较为一般但是更多的cpu core,因为更多的cpu core可以提供更强的并发处理能力,远比单个cpu性能高带来的收益要明显

## 磁盘设置
对于es来说,磁盘是非常重要的,尤其是对那些大量写入的es集群.  
对于大量写入的es集群来说,会很容易因为磁盘的读写性能造成整个集群的性能瓶颈  

一般来说,能够使用SSD固态硬盘是最好的,需要注意`I/O sheduler`的分配,当我们将数据写入磁盘时,`IO scheduler`会决定什么时候数据才会真正的写入吃片,而不是停留在os cache内存缓冲中.
```
linux默认的IO调度器算法是: 'CFQ算法' 
不过如果使用固态的话 算法选择上跟普通磁盘不一样 因为不涉及磁头读取等操作

推荐使用
1.Noop算法
   就是一个简单的FIFO队列先进先出的机制
   
2.Deadline算法
  会基于写操作被pending了多久时间来进行写磁盘优化.
  Deadline算法的核心在于保证每个IO请求在一定的时间内一定要被服务到，以此来避免某个请求饥饿。
  
如何切换算法:
//查看支持的算法
 dmesg | grep -i scheduler
//查看算法
/sys/block/vda/queue/scheduler

//修改算法
修改scheduler中的内容

```
<!--more-->

## 网络配置
高速网络通信 可以让es的节点间通信达到低延时的效果,
高宽带可以让shard的移动和恢复,已经分配等操作更加的快速. 现在对于大多数集群来说,性能都是够的.千兆网卡绰绰有余.

## 自建集群 or 云部署
自建集群:  
  要避免那种超大资源的超级服务器,因为那样可能造成资源无法完全利用,然后再一个物理机上部署多个es节点,这会导致我们的集群管理更加的复杂.  


 云部署:


一般,对于运维和管理来说,管理5个物理机组成的es集群,远远比管理100个虚拟机组成的es集群要简单的多.  
## JVM版本配置
尽可能选择最新版本   
需要注意的是:  
es是一个非常复杂的分布式软件系统,而且es的默认jvm配置都是基于真实业务场景中长期的实践得到的.  
随便调节JVM配置反而有可能导致集群性能变得更加差,以及出现一些未知的问题. 反而是很多情况下,将自定义的jvm全部删除,性能是保持的最好的  

如果我们用java来写es程序,要确保运行我们程序的jvm版本和es的jvm版本匹配,不然可能导致一些异常,比如java的序列化各个版本不一样.

## 容量规划

一般而言,对于中小型公司,建议是es集群承载的数据量在10亿规模以内.

同时如果数据量在10亿以内的规模,那么一般而言,如果提供5台以上的机器,每台机器的配置到8核64G的配置,一般都能hold住.  

如果读写特别频繁和承载更大的数据量 可能还需要更多的机子

注意: 如果你需要达到1s获取到数据的话
基本上要保证有足够的`os cache`去缓存几乎所有的数据